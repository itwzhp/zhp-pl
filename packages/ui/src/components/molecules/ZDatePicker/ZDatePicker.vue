<template>
  <component
    :is="tag"
    class="z-date-picker"
  />
</template>

<script>
import flatpickr from 'flatpickr';
import { Polish } from 'flatpickr/dist/l10n/pl';

export default {
  name: 'ZDatePicker',
  props: {
    tag: {
      type: String,
      default: 'div',
    },
    value: {
      type: Array,
      default: () => ([]),
    },
    settings: {
      type: Object,
      default: () => ({}),
    },
  },
  mounted() {
    const flatpickrConfig = {
      ...{
        minDate: '2010-05-28',
        maxDate: new Date(),
        locale: Polish,
        inline: true,
        mode: 'range',
        defaultDate: this.value,
        onReady(selectedDate, dateStr, instance) {
          // eslint-disable-next-line no-param-reassign
          instance.l10n.rangeSeparator = ' - ';
        },
        onValueUpdate: (selectedDates) => {
          if (selectedDates.length === 2) {
            this.$emit('input', selectedDates.map((date) => {
              const tzoffset = (new Date()).getTimezoneOffset() * 60000;
              return new Date(date - tzoffset).toISOString();
            }));
          }
        },
      },
      ...this.settings,
    };
    flatpickr(this.$el, flatpickrConfig);
  },
};
</script>

<style lang="scss">
  @import '~flatpickr/dist/flatpickr';
  

  .z-date-picker {
    & + .flatpickr-calendar {
      background: transparent;
      box-shadow: none;
    }
    background: transparent;
    box-shadow: none;
    color: var(--color-primary-darken);
    border: 1px solid var(--color-primary-darken);
    &::placeholder{
      color: var(--color-primary-lighten);
    }
  }

  .flatpickr {
    &-current-month {
      display: flex;
      align-items: center;
    }

    &-day {
      &:nth-child(7n+0) {
        border-radius: 0 50px 50px 0;
        box-shadow: none !important;

        &::after {
          box-shadow: none !important;
        }
      }

      &:nth-child(7n+1) {
        border-radius: 50px 0 0 50px;
        box-shadow: none !important;

        &::after {
          box-shadow: none !important;
        }
      }

      &.today {
        &,
        &.inRange {
          border: 0;
          color: #78a22f;

          &:hover {
            background-color: var(--color-primary-lighten, #a6ce39);
            color: #fff;
          }
        }

        &.inRange {
          background-color: #fff;

          &:hover {
            background-color: #fff;
            color: var(--color-primary-darken, #a6ce39);
          }
        }
      }

      &.selected.startRange,
      &.startRange.startRange,
      &.endRange.startRange,
      &.selected.endRange,
      &.startRange.endRange,
      &.endRange.endRange {
        border: 0 !important;
        background: var(--flatpicker-selected-color, #a6ce39);
        border-radius: 50%;
        box-shadow: none !important;
        color: #fff;

        &::after {
          position: absolute;
          z-index: -1;
          width: 50%;
          height: 100%;
          background: #fff;
          box-shadow: -5px 0 0 #fff, 5px 0 0 #fff;
          content: "";
        }
      }

      &.selected.startRange,
      &.startRange.startRange {
        &::after {
          right: 0;
        }
      }

      &.selected.endRange,
      &.endRange.endRange {
        &::after {
          left: 0;
        }
      }

      &.endRange.startRange {
        &::after {
          content: none;
        }
      }

      &.inRange {
        &,
        &.nextMonthDay:not(.endRange),
        &.prevMonthDay:not(.endRange) {
          border: 0;
          background: #fff;
          box-shadow: -5px 0 0 #fff, 5px 0 0 #fff;
        }
      }
    }

    &-weekdays {
      display: none;
    }

    &-months {
      .flatpickr-prev-month,
      .flatpickr-next-month {
        fill: var(--flatpicker-text-color, #7ba22e);

        &:hover svg {
          fill: var(--flatpicker-text-color, #7ba22e);
        }
      }
    }

    &-innerContainer {
      margin: 56px 0 0 0;
    }

    &-current-month {
      color: var(--flatpicker-text-color, #7ba22e);

      .flatpickr-monthDropdown-months,
      .numInputWrapper {
        background: transparent;

        &:hover {
          background: transparent;
        }
      }

      .flatpickr-monthDropdown-months {
        width: auto;
        -webkit-appearance: none;
        -moz-appearance: none;
      }

      .numInputWrapper {
        width: auto;

        span {
          &.arrowUp,
          &.arrowDown {
            display: none;
          }
        }
      }

      input.cur-year[disabled] {
        color: var(--flatpicker-text-color, #7ba22e);
      }
    }
  }
</style>
